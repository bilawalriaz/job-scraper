{% extends "base.html" %}

{% block title %}{{ job.title }} - Job Scraper{% endblock %}

{% block content %}
<style>
.breadcrumb {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 0;
    margin-bottom: 24px;
    font-size: 0.875rem;
}
.breadcrumb a {
    color: var(--text-secondary);
    text-decoration: none;
    transition: color 0.2s;
}
.breadcrumb a:hover {
    color: var(--primary-color);
}
.breadcrumb-separator {
    color: var(--text-muted);
}
.breadcrumb-current {
    color: var(--text-primary);
    font-weight: 500;
}

.job-description {
    max-height: 200px;
    overflow: hidden;
    transition: max-height 0.3s ease;
}
.job-description.expanded {
    max-height: none;
}
.show-more-btn {
    background: none;
    border: none;
    color: var(--primary-color);
    font-size: 0.875rem;
    font-weight: 500;
    padding: 8px 0;
    cursor: pointer;
    transition: opacity 0.2s;
}
.show-more-btn:hover {
    opacity: 0.8;
}

.detail-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
}
.detail-item small {
    display: block;
    color: var(--text-muted);
    font-size: 0.75rem;
    margin-bottom: 4px;
}
.detail-item p {
    margin: 0;
    font-weight: 500;
}
</style>

<!-- Breadcrumb -->
<div class="breadcrumb">
    <a href="/">Dashboard</a>
    <span class="breadcrumb-separator">/</span>
    <a href="/jobs">Jobs</a>
    <span class="breadcrumb-separator">/</span>
    <span class="breadcrumb-current">{{ job.title[:50] }}{% if job.title|length > 50 %}...{% endif %}</span>
</div>

<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px;">
    <!-- Main Content -->
    <div id="job-content">
        <div class="card">
            <div style="padding: 32px;">
                <!-- Header -->
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px;">
                    <div style="flex: 1;">
                        <h1 style="font-size: 1.75rem; font-weight: 700; margin-bottom: 8px; letter-spacing: -0.02em;">{{ job.title }}</h1>
                        <div style="display: flex; align-items: center; gap: 16px; color: var(--text-secondary); font-size: 0.9375rem;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                            </svg>
                            <span>{{ job.company }}</span>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            <span>{{ job.location }}</span>
                        </div>
                    </div>
                    <span class="status-badge status-{{ job.status or 'new' }}" style="font-size: 0.875rem;">
                        {{ (job.status or 'new').title() }}
                    </span>
                </div>

                <!-- Details Grid -->
                <div class="detail-grid">
                    <div class="detail-item">
                        <small>Salary</small>
                        <p>{% if job.salary %}{{ job.salary }}{% else %}<span style="color: var(--text-muted);">Not specified</span>{% endif %}</p>
                    </div>
                    <div class="detail-item">
                        <small>Posted</small>
                        <p>{{ job.posted_date or 'Unknown' }}</p>
                    </div>
                    <div class="detail-item">
                        <small>Employment Type</small>
                        <p>{{ job.employment_type|title or 'Not specified' }}</p>
                    </div>
                    <div class="detail-item">
                        <small>Source</small>
                        <p>{{ job.source|title }}</p>
                    </div>
                </div>

                <!-- Description -->
                <div style="margin-bottom: 32px;">
                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 16px;">Description</h3>
                    <div class="job-description" id="job-description">
                        {{ job.description|replace('\n', '<br>')|safe }}
                    </div>
                    <button class="show-more-btn" id="show-more-btn" _="on click toggle .expanded on #job-description then if #job-description.matches('.expanded') put 'Show Less' into my textContent else put 'Show More' into my textContent">
                        Show More
                    </button>
                </div>

                <!-- Actions -->
                <div style="display: flex; gap: 12px;">
                    {% if job.url %}
                    <a href="{{ job.url }}" target="_blank" class="btn btn-primary" style="text-decoration: none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                            <polyline points="15 3 21 3 21 9"></polyline>
                            <line x1="10" y1="14" x2="21" y2="3"></line>
                        </svg>
                        View Original
                    </a>
                    {% endif %}
                    <button class="btn btn-secondary"
                            hx-get="/htmx/jobs/{{ job.id }}/edit"
                            hx-target="#job-content">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                        Edit
                    </button>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- Sidebar -->
    <div>
        <!-- Status Card -->
        <div class="card" style="margin-bottom: 24px;">
            <div class="card-header">Status & Actions</div>
            <div style="padding: 20px;">
                <div style="margin-bottom: 20px;">
                    <label class="form-label">Status</label>
                    <select class="form-select"
                            hx-put="/htmx/jobs/{{ job.id }}/status"
                            hx-trigger="change"
                            name="status">
                        <option value="new" {{ 'selected' if job.status == 'new' else '' }}>New</option>
                        <option value="interested" {{ 'selected' if job.status == 'interested' else '' }}>Interested</option>
                        <option value="applied" {{ 'selected' if job.status == 'applied' else '' }}>Applied</option>
                        <option value="interviewing" {{ 'selected' if job.status == 'interviewing' else '' }}>Interviewing</option>
                        <option value="offer" {{ 'selected' if job.status == 'offer' else '' }}>Offer</option>
                        <option value="rejected" {{ 'selected' if job.status == 'rejected' else '' }}>Rejected</option>
                        <option value="archived" {{ 'selected' if job.status == 'archived' else '' }}>Archived</option>
                    </select>
                </div>

                <button class="btn {{ 'btn-success' if not job.is_applied else 'btn-secondary' }}"
                        style="width: 100%; margin-bottom: 12px;"
                        hx-put="/htmx/jobs/{{ job.id }}/applied"
                        hx-swap="outerHTML">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    {{ 'Mark Applied' if not job.is_applied else 'Applied' }}
                </button>

                <button class="btn btn-danger"
                        style="width: 100%;"
                        hx-confirm="Are you sure you want to delete this job?"
                        hx-delete="/htmx/jobs/{{ job.id }}"
                        hx-swap="outerHTML"
                        _="on htmx:afterRequest go to '/jobs'">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                    Delete
                </button>
            </div>
        </div>

        <!-- Notes Card -->
        <div class="card">
            <div class="card-header">Notes</div>
            <div style="padding: 20px;">
                <p style="font-size: 0.9375rem; color: var(--text-secondary); margin-bottom: 12px; min-height: 60px;">{{ job.notes or 'No notes' }}</p>
                <button class="btn btn-secondary btn-sm"
                        hx-get="/htmx/jobs/{{ job.id }}/edit"
                        hx-target="#job-content">
                    Add/Edit Notes
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
