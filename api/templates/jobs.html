{% extends "base.html" %}

{% block title %}Jobs - Job Scraper{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1>Jobs</h1>
    </div>
</div>

<!-- Filters -->
<div class="filter-panel">
    <div class="row g-3">
        <div class="col-md-4">
            <input type="text" class="form-control" name="search" placeholder="Search..."
                   hx-get="/htmx/jobs" hx-trigger="keyup changed delay:300ms" hx-target="#jobs-table">
        </div>
        <div class="col-md-2">
            <select class="form-select" name="status"
                    hx-get="/htmx/jobs" hx-trigger="change" hx-target="#jobs-table">
                <option value="">All Status</option>
                <option value="new" {{ 'selected' if filters.status == 'new' else '' }}>New</option>
                <option value="interested" {{ 'selected' if filters.status == 'interested' else '' }}>Interested</option>
                <option value="applied" {{ 'selected' if filters.status == 'applied' else '' }}>Applied</option>
                <option value="interviewing" {{ 'selected' if filters.status == 'interviewing' else '' }}>Interviewing</option>
                <option value="offer" {{ 'selected' if filters.status == 'offer' else '' }}>Offer</option>
                <option value="rejected" {{ 'selected' if filters.status == 'rejected' else '' }}>Rejected</option>
                <option value="archived" {{ 'selected' if filters.status == 'archived' else '' }}>Archived</option>
            </select>
        </div>
        <div class="col-md-2">
            <select class="form-select" name="employment_type"
                    hx-get="/htmx/jobs" hx-trigger="change" hx-target="#jobs-table">
                <option value="">All Types</option>
                <option value="contract" {{ 'selected' if filters.employment_type == 'contract' else '' }}>Contract</option>
                <option value="permanent" {{ 'selected' if filters.employment_type == 'permanent' else '' }}>Permanent</option>
                <option value="WHF" {{ 'selected' if filters.employment_type == 'WHF' else '' }}>Work From Home</option>
            </select>
        </div>
        <div class="col-md-2">
            <select class="form-select" name="source"
                    hx-get="/htmx/jobs" hx-trigger="change" hx-target="#jobs-table">
                <option value="">All Sources</option>
                <option value="totaljobs" {{ 'selected' if filters.source == 'totaljobs' else '' }}>TotalJobs</option>
            </select>
        </div>
        <div class="col-md-2">
            <div class="text-muted small mt-2">
                Showing {{ jobs|length }} of {{ total }} jobs
            </div>
        </div>
    </div>
</div>

<!-- Jobs Table -->
<div id="jobs-table" class="card">
    <div class="htmx-indicator text-center py-5">
        <div class="spinner-border text-primary" role="status"></div>
    </div>
</div>

<!-- Pagination -->
{% if total_pages > 1 %}
<nav aria-label="Jobs pagination" class="mt-3">
    <ul class="pagination justify-content-center">
        <li class="page-item {{ 'disabled' if page == 1 else '' }}">
            <a class="page-link" href="?page={{ page - 1 }}&per_page={{ per_page }}"
               hx-get="/htmx/jobs?page={{ page - 1 }}&per_page={{ per_page }}"
               hx-target="#jobs-table"
               hx-push-url="true">Previous</a>
        </li>
        {% for p in range(1, total_pages + 1) %}
            {% if p == page or p == 1 or p == total_pages or (p >= page - 2 and p <= page + 2) %}
                <li class="page-item {{ 'active' if p == page else '' }}">
                    <a class="page-link" href="?page={{ p }}&per_page={{ per_page }}"
                       hx-get="/htmx/jobs?page={{ p }}&per_page={{ per_page }}"
                       hx-target="#jobs-table"
                       hx-push-url="true">{{ p }}</a>
                </li>
            {% elif p == page - 3 or p == page + 3 %}
                <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
        {% endfor %}
        <li class="page-item {{ 'disabled' if page == total_pages else '' }}">
            <a class="page-link" href="?page={{ page + 1 }}&per_page={{ per_page }}"
               hx-get="/htmx/jobs?page={{ page + 1 }}&per_page={{ per_page }}"
               hx-target="#jobs-table"
               hx-push-url="true">Next</a>
        </li>
    </ul>
</nav>
{% endif %}

<script>
// Initial load
htmx.trigger('#jobs-table', 'load');
</script>
{% endblock %}
