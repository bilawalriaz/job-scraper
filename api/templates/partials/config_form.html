<div class="modal-header">
    <h3 class="modal-title">{{ 'New' if not config else 'Edit' }} Search Configuration</h3>
    <button class="btn-close" _="on click remove .show from #config-modal">&times;</button>
</div>
<form hx-post="{{ '/htmx/configs' if not config else '/htmx/configs/' ~ config.id }}"
      hx-target="#configs-table"
      _="on htmx:beforeRequest put '<div style=\"text-align:center;padding:40px;\"><div class=\"spinner\" style=\"width:40px;height:40px;margin:0 auto 16px;\"></div><p class=\"text-muted\">Saving...</p></div>' into #config-modal-content
         on htmx:afterRequest if htmx.detail.xhr.status == 200
            remove .show from #config-modal
            then send htmx:load to #configs-table">
    <div class="modal-body">
        <div class="mb-4">
            <label class="form-label" for="name">Name</label>
            <input type="text" class="form-control" id="name" name="name" value="{{ config.name if config else '' }}" required placeholder="e.g., DevOps London">
        </div>
        <div class="mb-4">
            <label class="form-label" for="keywords">Keywords</label>
            <input type="text" class="form-control" id="keywords" name="keywords" value="{{ config.keywords if config else '' }}" required placeholder="DevOps Engineer, Platform Engineer">
            <p class="text-muted small" style="margin-top: 6px;">Comma-separated keywords to search for</p>
        </div>
        <div class="mb-4">
            <label class="form-label" for="location">Location</label>
            <input type="text" class="form-control" id="location" name="location" value="{{ config.location if config else '' }}" required placeholder="London, Remote, Manchester">
        </div>
        <div class="mb-4">
            <label class="form-label" for="radius">Radius (miles)</label>
            <input type="number" class="form-control" id="radius" name="radius" value="{{ config.radius if config else 10 }}" min="0" max="30" required>
            <p class="text-muted small" style="margin-top: 6px;">Max 30 miles (site limitation)</p>
        </div>
        <div class="mb-4">
            <label class="form-label">Employment Types</label>
            <div class="employment-tags" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                <label class="employment-tag" style="cursor: pointer;">
                    <input type="checkbox" name="employment_type_tags" value="permanent" style="display: none;">
                    <span class="tag" style="
                        display: inline-block;
                        padding: 6px 12px;
                        background: var(--bg-color);
                        border: 1px solid var(--border-color);
                        border-radius: 20px;
                        font-size: 0.875rem;
                        transition: all 0.2s;
                    ">Permanent</span>
                </label>
                <label class="employment-tag" style="cursor: pointer;">
                    <input type="checkbox" name="employment_type_tags" value="contract" style="display: none;">
                    <span class="tag" style="
                        display: inline-block;
                        padding: 6px 12px;
                        background: var(--bg-color);
                        border: 1px solid var(--border-color);
                        border-radius: 20px;
                        font-size: 0.875rem;
                        transition: all 0.2s;
                    ">Contract</span>
                </label>
                <label class="employment-tag" style="cursor: pointer;">
                    <input type="checkbox" name="employment_type_tags" value="whf" style="display: none;">
                    <span class="tag" style="
                        display: inline-block;
                        padding: 6px 12px;
                        background: var(--bg-color);
                        border: 1px solid var(--border-color);
                        border-radius: 20px;
                        font-size: 0.875rem;
                        transition: all 0.2s;
                    ">Work From Home</span>
                </label>
            </div>
            <input type="hidden" id="employment_types" name="employment_types" value="{{ config.employment_types if config else '' }}">
            <p class="text-muted small" style="margin-top: 6px;">Select one or more types to filter</p>
        </div>
        <div class="mb-4">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" name="enabled" id="enabled" {{ 'checked' if (config and config.enabled) or not config else '' }} style="width: 18px; height: 18px;">
                <span style="font-size: 0.875rem; font-weight: 500;">Enabled for automated scraping</span>
            </label>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" _="on click remove .show from #config-modal">Cancel</button>
        <button type="submit" class="btn btn-primary">
            <span class="htmx-indicator" style="margin-right: 6px;">
                <span class="spinner"></span>
            </span>
            Save Configuration
        </button>
    </div>
</form>

<style>
.employment-tag input:checked + .tag {
    background: var(--primary-color, #f97316);
    color: white;
    border-color: var(--primary-color, #f97316);
}

.employment-tag:hover .tag {
    border-color: var(--primary-color, #f97316);
}
</style>

<script>
(function() {
    // Pre-select existing employment types
    const existingTypes = document.getElementById('employment_types').value;
    if (existingTypes) {
        existingTypes.split(',').forEach(type => {
            const checkbox = document.querySelector(`input[name="employment_type_tags"][value="${type.trim()}"]`);
            if (checkbox) checkbox.checked = true;
        });
    }

    // Update hidden input when tags are clicked
    document.querySelectorAll('input[name="employment_type_tags"]').forEach(checkbox => {
        checkbox.addEventListener('change', () => {
            const selected = Array.from(document.querySelectorAll('input[name="employment_type_tags"]:checked'))
                .map(cb => cb.value);
            document.getElementById('employment_types').value = selected.join(',');
        });
    });
})();
</script>
