<div class="modal-header">
    <h3 class="modal-title">{{ 'New' if not config else 'Edit' }} Search Configuration</h3>
    <button class="btn-close" _="on click remove .show from #config-modal">&times;</button>
</div>
<form hx-post="{{ '/htmx/configs' if not config else '/htmx/configs/' ~ config.id }}"
      hx-target="#configs-table"
      _="on htmx:beforeRequest put '<div style=\"text-align:center;padding:40px;\"><div class=\"spinner\" style=\"width:40px;height:40px;margin:0 auto 16px;\"></div><p class=\"text-muted\">Saving...</p></div>' into #config-modal-content
         on htmx:afterRequest if htmx.detail.xhr.status == 200
            remove .show from #config-modal
            then send htmx:load to #configs-table">
    <div class="modal-body">
        <div class="mb-4">
            <label class="form-label" for="name">Name</label>
            <input type="text" class="form-control" id="name" name="name" value="{{ config.name if config else '' }}" required placeholder="e.g., DevOps London">
        </div>
        <div class="mb-4">
            <label class="form-label" for="keywords">Keywords</label>
            <input type="text" class="form-control" id="keywords" name="keywords" value="{{ config.keywords if config else '' }}" required placeholder="DevOps Engineer, Platform Engineer">
            <p class="text-muted small" style="margin-top: 6px;">Comma-separated keywords to search for</p>
        </div>
        <div class="mb-4">
            <label class="form-label" for="location">Location</label>
            <input type="text" class="form-control" id="location" name="location" value="{{ config.location if config else '' }}" required placeholder="London, Remote, Manchester">
        </div>
        <div class="d-flex gap-3">
            <div class="mb-4" style="flex: 1;">
                <label class="form-label" for="radius">Radius (miles)</label>
                <input type="number" class="form-control" id="radius" name="radius" value="{{ config.radius if config else 10 }}" min="0" max="100">
            </div>
            <div class="mb-4" style="flex: 2;">
                <label class="form-label" for="employment_types">Employment Types</label>
                <input type="text" class="form-control" id="employment_types" name="employment_types" value="{{ config.employment_types if config else '' }}" placeholder="permanent,contract,whf">
                <p class="text-muted small" style="margin-top: 6px;">Optional: comma-separated</p>
            </div>
        </div>
        <div class="mb-4">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" name="enabled" id="enabled" {{ 'checked' if (config and config.enabled) or not config else '' }} style="width: 18px; height: 18px;">
                <span style="font-size: 0.875rem; font-weight: 500;">Enabled for automated scraping</span>
            </label>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" _="on click remove .show from #config-modal">Cancel</button>
        <button type="submit" class="btn btn-primary">
            <span class="htmx-indicator" style="margin-right: 6px;">
                <span class="spinner"></span>
            </span>
            Save Configuration
        </button>
    </div>
</form>

<script>
// Define Loading element template
document.body.insertAdjacentHTML('beforeend', `
    <template id="loading-template">
        <div style="text-align: center; padding: 40px;">
            <div class="spinner" style="width: 40px; height: 40px; margin: 0 auto 16px;"></div>
            <p class="text-muted">Saving...</p>
        </div>
    </template>
`);
</script>
